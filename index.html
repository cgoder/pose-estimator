<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥èº«å§¿æ€åˆ†æç³»ç»Ÿ (é‡æ„ç‰ˆ)</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸƒâ€â™‚ï¸</text></svg>">
    
    <!-- åŸºç¡€æ ·å¼ -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #ecf0f1;
            overflow: hidden;
        }
        
        #app {
            width: 100vw;
            height: 100vh;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .initial-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .initial-loading h1 {
            font-size: 2.5rem;
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .initial-loading .spinner {
            width: 60px;
            height: 60px;
            border: 6px solid rgba(255,255,255,0.3);
            border-top: 6px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }
        
        .initial-loading p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .initial-loading h1 {
                font-size: 2rem;
            }
        }
        
        /* ç¡®ä¿canvasæ­£ç¡®æ˜¾ç¤º */
        #pose-canvas {
            display: block;
            max-width: 100%;
            max-height: 100%;
        }
    </style>
</head>
<body>
    <!-- åº”ç”¨å®¹å™¨ -->
    <div id="app">
        <div class="initial-loading">
            <h1>ğŸƒâ€â™‚ï¸ å¥èº«å§¿æ€åˆ†æç³»ç»Ÿ</h1>
            <div class="spinner"></div>
            <p>æ­£åœ¨åŠ è½½é‡æ„ç‰ˆæœ¬...</p>
        </div>
    </div>

    <!-- éšè—çš„Canvaså…ƒç´ ï¼Œå°†ç”±åº”ç”¨åŠ¨æ€æ˜¾ç¤º -->
    <canvas id="canvas" width="640" height="480" style="display: none;"></canvas>

    <!-- åº”ç”¨å¯åŠ¨è„šæœ¬ -->
    <script type="module">
        // æ£€æŸ¥æµè§ˆå™¨å…¼å®¹æ€§
        function checkBrowserCompatibility() {
            const issues = [];
            
            // æ£€æŸ¥åŸºæœ¬ API
            if (!window.navigator.mediaDevices) {
                issues.push('ä¸æ”¯æŒåª’ä½“è®¾å¤‡API');
            }
            
            if (!window.requestAnimationFrame) {
                issues.push('ä¸æ”¯æŒrequestAnimationFrame');
            }
            
            // æ£€æŸ¥ WebGL
            const canvas = document.createElement('canvas');
            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
            if (!gl) {
                issues.push('ä¸æ”¯æŒWebGL');
            }
            
            return issues;
        }
        
        // æ˜¾ç¤ºå…¼å®¹æ€§é—®é¢˜
        function showCompatibilityIssues(issues) {
            const app = document.getElementById('app');
            app.innerHTML = `
                <div style="
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    height: 100vh;
                    padding: 2rem;
                    text-align: center;
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                ">
                    <div style="
                        background: #fff3cd;
                        border: 2px solid #ffeaa7;
                        border-radius: 8px;
                        padding: 2rem;
                        max-width: 500px;
                    ">
                        <h1 style="color: #856404; margin: 0 0 1rem 0;">âš ï¸ æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜</h1>
                        <p style="margin: 0 0 1rem 0; color: #856404;">
                            æ‚¨çš„æµè§ˆå™¨å¯èƒ½ä¸å®Œå…¨æ”¯æŒæ­¤åº”ç”¨ï¼Œå‘ç°ä»¥ä¸‹é—®é¢˜ï¼š
                        </p>
                        <ul style="text-align: left; color: #856404; margin: 0 0 1rem 0;">
                            ${issues.map(issue => `<li>${issue}</li>`).join('')}
                        </ul>
                        <p style="margin: 0 0 1rem 0; color: #856404;">
                            å»ºè®®ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Chromeã€Firefox æˆ– Safari æµè§ˆå™¨ã€‚
                        </p>
                        <button onclick="location.reload()" style="
                            background: #007bff;
                            color: white;
                            border: none;
                            padding: 0.75rem 1.5rem;
                            border-radius: 6px;
                            cursor: pointer;
                        ">ğŸ”„ é‡è¯•</button>
                    </div>
                </div>
            `;
        }
        
        // ç­‰å¾…åº”ç”¨æ¨¡å—åŠ è½½ï¼ˆä¸å†ç­‰å¾… TensorFlow.jsï¼‰
        async function waitForAppModule() {
            // ç›´æ¥å°è¯•åŠ è½½åº”ç”¨æ¨¡å—ï¼Œè®©åº”ç”¨å†…éƒ¨å†³å®šå¦‚ä½•åŠ è½½ TensorFlow.js
            return true;
        }
        
        // ä¸»å¯åŠ¨å‡½æ•°
        async function main() {
            try {
                // æ£€æŸ¥æµè§ˆå™¨å…¼å®¹æ€§
                const compatibilityIssues = checkBrowserCompatibility();
                if (compatibilityIssues.length > 0) {
                    console.warn('âš ï¸ æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜:', compatibilityIssues);
                    // æ˜¾ç¤ºè­¦å‘Šä½†ç»§ç»­è¿è¡Œ
                }
                
                // ç­‰å¾…åº”ç”¨æ¨¡å—å‡†å¤‡
                console.log('ğŸ“¦ å‡†å¤‡åŠ è½½åº”ç”¨æ¨¡å—...');
                await waitForAppModule();
                console.log('âœ… åº”ç”¨æ¨¡å—å‡†å¤‡å®Œæˆ');
                
                // åŠ¨æ€å¯¼å…¥åº”ç”¨æ¨¡å—
                console.log('ğŸš€ å¯åŠ¨åº”ç”¨æ¨¡å—...');
                const timestamp = Date.now();
                const randomId = Math.random().toString(36).substring(7);
                const { startApp } = await import(`./dist/app.js?v=${timestamp}&r=${randomId}`);
                
                // å¯åŠ¨åº”ç”¨
                await startApp();
                
            } catch (error) {
                console.error('âŒ åº”ç”¨å¯åŠ¨å¤±è´¥:', error);
                
                // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                const app = document.getElementById('app');
                app.innerHTML = `
                    <div style="
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        height: 100vh;
                        padding: 2rem;
                        text-align: center;
                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                    ">
                        <div style="
                            background: #f8d7da;
                            border: 2px solid #f5c6cb;
                            border-radius: 8px;
                            padding: 2rem;
                            max-width: 500px;
                        ">
                            <h1 style="color: #721c24; margin: 0 0 1rem 0;">ğŸš¨ å¯åŠ¨å¤±è´¥</h1>
                            <p style="margin: 0 0 1rem 0; color: #721c24;">
                                åº”ç”¨æ— æ³•æ­£å¸¸å¯åŠ¨ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–åˆ·æ–°é¡µé¢é‡è¯•ã€‚
                            </p>
                            <details style="text-align: left; margin-top: 1rem;">
                                <summary style="cursor: pointer; color: #721c24;">é”™è¯¯è¯¦æƒ…</summary>
                                <pre style="
                                    background: #f5f5f5;
                                    padding: 1rem;
                                    border-radius: 4px;
                                    margin-top: 0.5rem;
                                    font-size: 0.8rem;
                                    overflow: auto;
                                    color: #333;
                                ">${error.message}</pre>
                            </details>
                            <button onclick="location.reload()" style="
                                background: #dc3545;
                                color: white;
                                border: none;
                                padding: 0.75rem 1.5rem;
                                border-radius: 6px;
                                cursor: pointer;
                                margin-top: 1rem;
                            ">ğŸ”„ é‡æ–°åŠ è½½</button>
                        </div>
                    </div>
                `;
            }
        }
        
        // å¯åŠ¨åº”ç”¨
        main();
    </script>
</body>
</html>